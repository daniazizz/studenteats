{% extends "blog/base.html" %}
{% load crispy_forms_tags %}
{% load static %}

{% block extra_css %}
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
    <link rel="stylesheet" href="{% static 'blog/rating-icons.css' %}">
{% endblock extra_css %}

{% block content %}
  <div class="content-section">
      <form method="POST", enctype="multipart/form-data">
          {% csrf_token %}
          <fieldset class="form-group">
              <legend class="border-bottom mb-4">Review</legend>
              <!-- CAROUSEL -->
                <div id="post-carousel-{{forloop.counter }}" class="carousel slide w-50" data-interval="false" data-ride="carousel"> <!-- data-interval = autoslide -->
                    <div class="carousel-inner">
                    {% for image in post.images.all %}
                        {% if forloop.first %}
                        <div class="carousel-item active">
                            <img class="d-block" src="{{ image.image.url }}" alt="First slide">
                        </div>
                        {% else %}
                        <div class="carousel-item">
                            <img class="d-block" src="{{ image.image.url }}" alt="Next slide">
                        </div>
                        {% endif %}
                    {% endfor %}
                    </div>
                    <a class="carousel-control-prev" href="#post-carousel-{{forloop.counter }}" role="button" data-slide="prev">
                        <span class="carousel-control-prev-icon" aria-hidden="true"></span>
                        <span class="sr-only">Previous</span>
                    </a>
                    <a class="carousel-control-next" href="#post-carousel-{{forloop.counter }}" role="button" data-slide="next">
                        <span class="carousel-control-next-icon" aria-hidden="true"></span>
                        <span class="sr-only">Next</span>
                    </a>
                </div>
                <!-- END CAROUSEL -->
              {{ form |crispy }}
              <input id="rating" name="rating" type="hidden" value="0">
              <p>Rating: <span class="fa fa-star fa-lg"></span> <span class="fa fa-star fa-lg"></span> <span class="fa fa-star fa-lg"></span> <span class="fa fa-star fa-lg"></span> <span class="fa fa-star fa-lg"></span></p>
              <input id="cost" name="cost" type="hidden" value="0">
              <p>Cost: <span class="fa fa-eur fa-lg"></span> <span class="fa fa-eur fa-lg"></span> <span class="fa fa-eur fa-lg"></span> <span class="fa fa-eur fa-lg"></span> <span class="fa fa-eur fa-lg"></span></p>
          </fieldset>
          <div class="form-group">
              <button class="btn btn-outline-secondary" type="submit">Update</button>
          </div>
      </form>
  </div>
{% endblock content %}

{% block extra_jss %}
    <script>
    var stars = document.getElementsByClassName("fa-star");
    var dollars = document.getElementsByClassName("fa-eur");

    var ratingInput = document.getElementById("rating");
    var costInput = document.getElementById("cost");

    function addHoverEffectOn(elements, className1, className2) {
        for(let i = 0; i < elements.length; ++i){
            let element = elements[i];
            element.onmouseover = function() {
                if(!element.classList.contains(className1)){
                    for(k = 0; k <= i; ++k){
                        elements[k].classList.add(className1);
                        elements[k].classList.remove(className2);
                    }
                    for(k = elements.length-1; k > i; --k){
                        if(elements[k].classList.contains(className2)){
                            elements[k].classList.remove(className2);
                        }
                    }
                }
            }
        }
    }

    function addOutFocusEffectOn(elements, className){
        for(let i = 0; i < elements.length; ++i){
            let element = elements[i];
            element.onmouseout = function() {
                if(element.classList.contains(className)){
                    for(k = 0; k <= i; ++k){
                        elements[k].classList.remove(className);
                    }
                }
            }
        }
    }

    function addClickEffectOn(elements, className){
        for(let i = 0; i < elements.length; ++i){
            let element = elements[i];
            element.onclick = function() {
                let value = i + 1;
                if(className == "clicked")
                    ratingInput.value = value;
                else
                    costInput.value = value;
                for(k = 0; k <= i; ++k){
                    elements[k].classList.add(className);
                }
            }
        }
    }

    addHoverEffectOn(stars, "checked", "clicked");
    addOutFocusEffectOn(stars, "checked");
    addClickEffectOn(stars, "clicked");
    addHoverEffectOn(dollars, "checked2", "clicked2");
    addOutFocusEffectOn(dollars, "checked2");
    addClickEffectOn(dollars, "clicked2");

  </script>
{% endblock extra_jss %}