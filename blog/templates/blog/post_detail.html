{% extends "blog/base.html" %}
{% load static %}

{% block extra_css %}
<style>
  body {
    background-color: black;
    height: 100%;
    width: 100%;
  }

  #commentSection {
      background-color: white;
      width: 50%;
      font-family: Arial, sans-serif;
    /*padding-bottom: 10%;*/
      height: 50%;
      border-radius: 5px;
  }

  #push {
    margin-bottom: 5%;
  }


  textarea {
    width: 100%;
  }

</style>
{% endblock extra_css %}
{% block content %}

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
<link rel="stylesheet" href="{% static 'blog/rating-icons.css' %}">

<article class="media content-section">
  <a class="mr-2" href="{% url 'profile' post.author.username %}">
    <img class="rounded-circle article-img" src="{{ post.author.profile.image.url }}" alt="author's image">
  </a>
  <div class="media-body">
    <div class="article-metadata">
      <a class="mr-2" href="{% url 'profile' post.author.username %}">{{ post.author }}</a>
      <small class="text-muted">{{ post.date_posted |date:"F d, Y"}}</small>

      <div style="margin-left: 2%; display: inline-block;">
        {% if post.author == user %}
        <a class="btn btn-secondary btn-sm mb-1" href="{% url 'post-update' post.id %}">Update</a>
        <a class="btn btn-danger btn-sm mb-1" href="{% url 'post-delete' post.id %}">Delete</a>
        {% endif %}
      </div>

      <div style="display: inline-block; float: right;" id="sharebuttons" class="sharethis-inline-share-buttons"></div>


      <p>Rating: <span class="fa fa-star fa-lg star"></span> <span class="fa fa-star fa-lg star"></span> <span class="fa fa-star fa-lg star"></span> <span class="fa fa-star fa-lg star"></span> <span class="fa fa-star fa-lg star"></span><br>
        Cost: <span class="fa fa-eur fa-lg euro"></span> <span class="fa fa-eur fa-lg euro"></span> <span class="fa fa-eur fa-lg euro"></span> <span class="fa fa-eur fa-lg euro"></span> <span class="fa fa-eur fa-lg euro"></span></p>
      <h2 class="article-title">{{ post.title }}</h2>
      <!-- Eating place link -->
      <p>
        Eating place: <a href="{% url 'place-profile' post.place %}">{{ post.place.name }}</a>
      </p>
      <!-- CAROUSEL -->
      {% include 'blog/blocks/carousel.html' %}
      <p class="article-content">{{ post.content }}</p>

      <!-- Post like button: -->
      <a class="like-btn btn btn-success btn-sm mb-1" data-href="{% url 'api-post-like' post.id %}" href="{% url 'post-like' post.id %}">
        {% if user in post.likes.all %}
        {{ post.likes.count }} Unlike
        {% else %}
        {{ post.likes.count }} Like
        {% endif %}
      </a>
    </div>
  </div>
</article>

<div id="commentSection">
  <div id="postedComments">
    <p id="intro">Be the first to react</p>
  </div>
  <div id="textSection">
    <input name="userComment" id="userComment" type="text"></input>
    <button id="trigger">comment!</button>
  </div>
</div>
    <div id="push"></div>
{% endblock content %}

{% block extra_jss %}
<script>
  var stars = document.getElementsByClassName("fa-star");
  var euros = document.getElementsByClassName("fa-eur");

  function lightUp(rating, lst, className) {
    for (i = 0; i < rating; ++i) {
      lst[i].classList.add(className);
    }
  }

  lightUp({{ post.rating }}, stars, "checked");
  lightUp({{ post.cost }}, euros, "checked2");

  var submitButton = document.getElementById("trigger");
  var userComment = document.getElementById("userComment");
  var postedComments = document.getElementById("postedComments");
  var firstComment = true;


  function createComment(commentOfUser) {
    let newComment = document.createElement("div");
    let paraph = document.createElement("p");
    paraph.innerText = commentOfUser;
    newComment.appendChild(paraph);
    postedComments.prepend(newComment);

  }

  submitButton.onclick = function() {

        $.ajax({
            url: '{% url "comment" %}',
            method: "GET",
            data: {
              'content': userComment.value,
              'author': '{{ user.username }}',
              'post_id': '{{ post.id }}'}
              
            })
        
      
      userComment.value = ""; 
       }


</script>
{% endblock extra_jss %}
